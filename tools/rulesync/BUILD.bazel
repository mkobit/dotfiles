load(":rules.bzl", "rulesync_generate")

sh_test(
    name = "rulesync_test",
    srcs = ["rulesync_test.sh"],
    args = ["$(rootpath @multitool//tools/rulesync)"],
    data = ["@multitool//tools/rulesync"],
)

rulesync_generate(
    name = "test_config",
    srcs = glob(["test_data/rules/*.md"]),
    out = "test_config_out",
    config = "test_data/rulesync.jsonc",
    strip_prefix = "tools/rulesync/test_data",
    targets = [
        "cursor",
        "claudecode",
    ],
)

sh_test(
    name = "verify_rulesync_output",
    srcs = ["verify_rulesync_output.sh"],
    args = ["$(location :test_config)"],
    data = [":test_config"],
)
