load(":rules.bzl", "rulesync_generate")

sh_test(
    name = "rulesync_test",
    srcs = ["rulesync_test.sh"],
    args = ["$(rootpath @multitool//tools/rulesync)"],
    data = ["@multitool//tools/rulesync"],
)

rulesync_generate(
    name = "test_config",
    srcs = glob(["test_data/rules/*.md"]),
    config = "test_data/rulesync.jsonc",
    strip_prefix = "tools/rulesync/test_data",
    targets = ["cursor", "claudecode"],
    out = "test_config_out",
)

sh_test(
    name = "verify_rulesync_output",
    srcs = ["verify_rulesync_output.sh"],
    data = [":test_config"],
    args = ["$(location :test_config)"],
)
