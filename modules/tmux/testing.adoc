= Testing the tmux Module
:toc: left
:icons: font
:source-highlighter: rouge

This document provides commands and procedures for testing the tmux configuration module in our Bazel-powered dotfiles system.

== Basic Testing Commands

[source,bash]
----
# Build the tmux configuration
bazel build //modules/tmux:tmux_conf

# View the generated configuration
cat bazel-bin/modules/tmux/tmux.conf

# View the source-file instructions
bazel build //modules/tmux:print_path
cat bazel-bin/modules/tmux/tmux_path.txt
----

== Running Test Sessions

=== Default Configuration

[source,bash]
----
# Create a new tmux session with our configuration
tmux -f bazel-bin/modules/tmux/tmux.conf new-session -d -s test_session

# Attach to the test session
tmux attach-session -t test_session

# After testing, exit the session with:
# Ctrl+a :kill-session
# Or from outside tmux:
# tmux kill-session -t test_session
----

=== Testing Key Bindings

Once in the tmux test session, try these key bindings:

[cols="1,2"]
|===
|Key Sequence|Expected Result

|`Ctrl+a \|`
|Split the window horizontally

|`Ctrl+a -`
|Split the window vertically

|`Ctrl+a h/j/k/l`
|Navigate between panes

|`Alt+Arrow keys`
|Navigate between panes

|`Shift+Arrow keys`
|Switch windows

|`Ctrl+a c`
|Create a new window

|`Ctrl+a a`
|Toggle to last active window

|`Ctrl+a r`
|Reload configuration (should display message)
|===

=== Testing Copy Mode

[cols="1,2"]
|===
|Key Sequence|Expected Result

|`Ctrl+a [`
|Enter copy mode

|`v` (in copy mode)
|Start selection

|`y` (in copy mode)
|Copy selection to system clipboard

|`V` (in copy mode)
|Select entire line

|`Escape`
|Exit copy mode without copying

|`Enter`
|Copy selection and exit copy mode
|===

== Testing Variant-Specific Configurations

=== Work Variant

[source,bash]
----
# Build the work variant
bazel build //modules/tmux:work_tmux_conf

# Create a test session with work config
tmux -f bazel-bin/modules/tmux/work_tmux.conf new-session -d -s work_test

# Attach to the work variant session
tmux attach -t work_test

# Verify that "work" appears in the config (grep for variant)
grep -C 2 "work" bazel-bin/modules/tmux/work_tmux.conf
----

=== Personal Variant

[source,bash]
----
# Build the personal variant
bazel build //modules/tmux:personal_tmux_conf

# Create a test session with personal config
tmux -f bazel-bin/modules/tmux/personal_tmux.conf new-session -d -s personal_test

# Attach to the personal variant session
tmux attach -t personal_test

# Verify that "personal" appears in the config (grep for variant)
grep -C 2 "personal" bazel-bin/modules/tmux/personal_tmux.conf
----

== Testing the Source-File Method

[source,bash]
----
# Create a minimal temporary tmux config
echo "source-file $(pwd)/bazel-bin/modules/tmux/tmux.conf" > /tmp/test_tmux.conf

# Start tmux with the temporary config
tmux -f /tmp/test_tmux.conf new-session -d -s source_test

# Attach to the session
tmux attach -t source_test

# Clean up
rm /tmp/test_tmux.conf
----

== Cross-Platform Testing

=== Testing on macOS

[source,bash]
----
# Test clipboard integration on macOS
# In tmux with our config, select text and copy with 'y'
# Then paste in another application

# Verify the correct macOS clipboard command is used
grep -C 2 "pbcopy" bazel-bin/modules/tmux/tmux.conf
----

=== Testing on Linux

[source,bash]
----
# Test clipboard integration on Linux
# In tmux with our config, select text and copy with 'y'
# Then paste in another application

# Verify the correct Linux clipboard command is used
grep -C 2 "xclip" bazel-bin/modules/tmux/tmux.conf
----

== Testing with Existing User Configuration

[source,bash]
----
# Backup current tmux config if it exists
[ -f ~/.tmux.conf ] && cp ~/.tmux.conf ~/.tmux.conf.backup

# Create a temporary config that sources both the user's original config
# and our generated config
echo "source-file ~/.tmux.conf.backup" > /tmp/combined_tmux.conf
echo "source-file $(pwd)/bazel-bin/modules/tmux/tmux.conf" >> /tmp/combined_tmux.conf

# Start tmux with the combined config
tmux -f /tmp/combined_tmux.conf new-session

# After testing, restore the original config
# mv ~/.tmux.conf.backup ~/.tmux.conf
# rm /tmp/combined_tmux.conf
----