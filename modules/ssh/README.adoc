= SSH Configuration Module
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: pygments

== Overview

The SSH module provides a Bazel-based system for generating SSH configuration files. It allows creating different SSH configurations for work, personal, and repository-specific contexts, all managed through Bazel's build system.

== Features

* Platform-aware SSH configurations (Linux, macOS, Windows)
* Context-specific variants (personal, work)
* Repository-specific configurations (GitHub, GitLab, etc.)
* No installation to home directory, purely generates configuration files
* Designed to work alongside standard SSH tools

== Usage

=== Building Configurations

To generate all SSH configurations:

[source,bash]
----
bazel build //tools/ssh:ssh_configs
----

Individual configs can be built with:

[source,bash]
----
# Main configuration
bazel build //modules/ssh:ssh_config

# Personal configuration
bazel build //modules/ssh:personal_ssh_config

# Work configuration
bazel build //modules/ssh:work_ssh_config

# GitHub-specific configuration
bazel build //modules/ssh:github_ssh_config
----

=== Using Generated Configurations

To use a generated configuration directly with SSH:

[source,bash]
----
# Using main config
ssh -F $(bazel info bazel-bin)/modules/ssh/ssh_config.ssh_config example.com

# Using personal config
ssh -F $(bazel info bazel-bin)/modules/ssh/personal_ssh_config.ssh_config personal-server.example.com

# Using work config
ssh -F $(bazel info bazel-bin)/modules/ssh/work_ssh_config.ssh_config work-server.example.com
----

=== Repository-specific Configurations

For repository-specific configurations:

[source,bash]
----
# Clone using GitHub-specific config
git -c core.sshCommand="ssh -F $(bazel info bazel-bin)/modules/ssh/github_ssh_config.ssh_config" clone git@github.com:username/repo.git

# Clone using GitLab-specific config
git -c core.sshCommand="ssh -F $(bazel info bazel-bin)/modules/ssh/gitlab_ssh_config.ssh_config" clone git@gitlab.com:username/repo.git
----

==== Using Different GitHub Keys for Different Repositories

The complex GitHub configuration allows you to use different SSH keys for different GitHub repositories:

[source,bash]
----
# Clone a repository using the default GitHub key
git -c core.sshCommand="ssh -F $(bazel info bazel-bin)/modules/ssh/complex_github_ssh_config.ssh_config" \
  clone git@github.com:username/repo.git

# Clone a repository using the organization-specific key
git -c core.sshCommand="ssh -F $(bazel info bazel-bin)/modules/ssh/complex_github_ssh_config.ssh_config" \
  clone git@github.com-org1:organization/repo.git

# Clone a repository using the project-specific key
git -c core.sshCommand="ssh -F $(bazel info bazel-bin)/modules/ssh/complex_github_ssh_config.ssh_config" \
  clone git@github.com-project1:username/special-project.git
----

Configure a repository to always use the complex GitHub configuration:

[source,bash]
----
cd /path/to/repo
git config core.sshCommand "ssh -F $(bazel info bazel-bin)/modules/ssh/complex_github_ssh_config.ssh_config"
----

=== Printing Generated Configuration Paths

To see the paths of all generated configurations:

[source,bash]
----
bazel run //tools/ssh:print_paths
----

== Configuration Structure

Each SSH configuration consists of:

* Global options (applied to all hosts)
* Platform-specific options
* Host-specific configurations
* Variant-specific settings

== Extending

=== Adding New Host Configurations

To add a new host configuration, update the appropriate target in `modules/ssh/BUILD.bazel`:

[source,python]
----
ssh_config(
    name = "personal_config",
    includes = [":base_config"],
    hosts = {
        "new.host.example.com.User": "username",
        "new.host.example.com.IdentityFile": "~/.ssh/id_custom",
    },
)
----

=== Creating New Variants

To create a new variant:

1. Define a new variant config in `modules/ssh/BUILD.bazel`
2. Create a generator for the variant
3. Add it to the filegroup in `tools/ssh/BUILD.bazel`

== Manual Installation (Optional)

If you wish to manually install the generated configurations:

[source,bash]
----
# Copy main configuration
mkdir -p ~/.ssh
cp $(bazel info bazel-bin)/modules/ssh/ssh_config.ssh_config ~/.ssh/config

# Copy specialized configurations
cp $(bazel info bazel-bin)/modules/ssh/github_ssh_config.ssh_config ~/.ssh/config.github
----

== Integration

This module is designed to work with existing SSH keys and configurations. It generates config files but does not modify existing keys or permissions.

== See Also

* SSH Key Management (separate from this module)
* SSH Agent Configuration
* Git SSH Configuration