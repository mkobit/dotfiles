= SSH Configuration Module
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: pygments

== Overview

The SSH module provides a Bazel-based system for generating and managing SSH configuration files. It allows creating different SSH configurations for work, personal, and repository-specific contexts, all managed through Bazel's build system.

== Features

* Platform-aware SSH configurations (Linux, macOS, Windows)
* Context-specific variants (personal, work)
* Repository-specific configurations (GitHub, GitLab, etc.)
* Integration with existing SSH keys and configurations
* No modification of existing SSH key permissions or files
* Designed to work alongside standard SSH tools

== Usage

=== Basic Usage

To install the base SSH configuration:

[source,bash]
----
bazel run //tools/ssh:ssh_config_dotfile
----

=== Installing Variant Configurations

To install specific variant configurations:

[source,bash]
----
# Personal configuration
bazel run //tools/ssh:personal_ssh_config_dotfile

# Work configuration
bazel run //tools/ssh:work_ssh_config_dotfile
----

=== Repository-specific Configurations

To install configurations for specific repositories:

[source,bash]
----
# GitHub-specific configuration
bazel run //tools/ssh:github_ssh_config_dotfile

# GitLab-specific configuration
bazel run //tools/ssh:gitlab_ssh_config_dotfile

# Complex GitHub configuration with multiple repository keys
bazel run //tools/ssh:complex_github_ssh_config_dotfile
----

==== Using Different GitHub Keys for Different Repositories

The complex GitHub configuration allows you to use different SSH keys for different GitHub repositories:

[source,bash]
----
# Clone a repository using the default GitHub key
git clone git@github.com:username/repo.git

# Clone a repository using the organization-specific key
git clone git@github.com-org1:organization/repo.git

# Clone a repository using the project-specific key
git clone git@github.com-project1:username/special-project.git
----

Configure a repository to use the complex GitHub configuration:

[source,bash]
----
cd /path/to/repo
git config core.sshCommand "ssh -F ~/.ssh/config.github_complex"
----

=== Using Variant Configurations

To use a specific configuration:

[source,bash]
----
ssh -F ~/.ssh/config.personal example.com
ssh -F ~/.ssh/config.work work-server.example.com
----

== Configuration Structure

Each SSH configuration consists of:

* Global options (applied to all hosts)
* Platform-specific options
* Host-specific configurations
* Variant-specific settings

== Extending

=== Adding New Host Configurations

To add a new host configuration, update the appropriate target in `modules/ssh/BUILD.bazel`:

[source,python]
----
ssh_config(
    name = "personal_config",
    includes = [":base_config"],
    hosts = {
        "new.host.example.com.User": "username",
        "new.host.example.com.IdentityFile": "~/.ssh/id_custom",
    },
)
----

=== Creating New Variants

To create a new variant:

1. Define a new variant config in `modules/ssh/BUILD.bazel`
2. Create a generator for the variant
3. Add a dotfile target in `tools/ssh/BUILD.bazel`

== Integration

This module is designed to work with existing SSH keys and configurations. It generates config files but does not modify existing keys or permissions.

== See Also

* SSH Key Management (separate from this module)
* SSH Agent Configuration
* Git SSH Configuration