#!/bin/sh
tempfile="$(mktemp)"
trap 'rm -rf "${tempfile}"' EXIT
cat > "${tempfile}"

# Remove existing chezmoi section if present
sed -i.bak '/modify_dot_gitconfig\.tmpl:BEGIN:chezmoi:git/,/modify_dot_gitconfig\.tmpl:END:chezmoi:git/d' "${tempfile}"

# Add our managed section
cat >> "${tempfile}" << 'EOF'

# {{ .chezmoi.workingTree }}/{{ .chezmoi.sourceFile }}:BEGIN:chezmoi:git:{{ include "modify_dot_gitconfig.tmpl" | sha256sum | substr 0 8 }} - WARNING: managed by chezmoi, do not edit
[include]
  path = {{ .chezmoi.homeDir }}/.dotfiles/git/config
# {{ .chezmoi.workingTree }}/{{ .chezmoi.sourceFile }}:END:chezmoi:git:{{ include "modify_dot_gitconfig.tmpl" | sha256sum | substr 0 8 }}
EOF

cat "${tempfile}"