#!/bin/sh
tempfile="$(mktemp)"
trap 'rm -rf "${tempfile}"' EXIT
cat > "${tempfile}"

# Add our managed section if not present
if ! grep -q "# {{ .chezmoi.sourceFile }}:BEGIN:chezmoi:git" "${tempfile}"; then
  cat >> "${tempfile}" << 'EOF'

# {{ .chezmoi.sourceFile }}:BEGIN:chezmoi:git
# Generated by chezmoi modify script - Host: {{ .chezmoi.hostname }} User: {{ .chezmoi.username }}
# WARNING: Do not edit this section manually - managed by chezmoi
[include]
  path = {{ .chezmoi.homeDir }}/.dotfiles/git/config
# {{ .chezmoi.sourceFile }}:END:chezmoi:git
EOF
fi

cat "${tempfile}"