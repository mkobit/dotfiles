{{ if eq .ghostty.installation "package-manager" }}#!/bin/bash

# logging.sh hash: {{ include "scripts/logging.sh" | sha256sum }}
source "${CHEZMOI_SOURCE_DIR:?}/scripts/logging.sh"

# Check if ghostty is already installed
if check_command ghostty; then 
    log_success "ghostty already installed at $(command -v ghostty)"
    exit 0
fi

log_info "Installing ghostty via package manager..."

{{ if eq .chezmoi.os "darwin" }}
# macOS - use Homebrew Cask
if ! check_command brew; then
    log_error "Homebrew not found. Please install Homebrew first."
    exit 1
fi

if brew install --cask ghostty; then
    log_success "ghostty installed successfully via homebrew cask"
else
    log_error "Failed to install ghostty via homebrew cask"
    exit 1
fi
{{ else if eq .chezmoi.os "linux" }}
# Linux
if command -v apt-get >/dev/null 2>&1; then
    # Ubuntu/Debian
    log_info "Installing ghostty via apt (Ubuntu/Debian)"
    
    if sudo apt-get update && sudo apt-get install -y ghostty; then
        log_success "ghostty installed successfully via apt"
    else
        log_error "Failed to install ghostty via apt"
        log_info "ghostty may not be available in your distribution's repositories"
        log_info "See https://ghostty.org/docs/install/binary for manual installation"
        exit 1
    fi
    
elif command -v pacman >/dev/null 2>&1; then
    # Arch Linux - official repos only
    log_info "Installing ghostty via pacman (Arch Linux)"
    
    if sudo pacman -S --noconfirm ghostty; then
        log_success "ghostty installed successfully via pacman"
    else
        log_error "Failed to install ghostty via pacman"
        log_info "ghostty may not be available in official repositories"
        log_info "Consider using AUR or see https://ghostty.org/docs/install/binary"
        exit 1
    fi
    
elif command -v dnf >/dev/null 2>&1; then
    # Fedora
    log_info "Installing ghostty via dnf (Fedora)"
    
    if sudo dnf install -y ghostty; then
        log_success "ghostty installed successfully via dnf"
    else
        log_error "Failed to install ghostty via dnf"
        log_info "ghostty may not be available in Fedora repositories"
        log_info "See https://ghostty.org/docs/install/binary for manual installation"
        exit 1
    fi
    
else
    log_error "Unsupported Linux distribution or package manager not found"
    log_info "Supported: apt (Ubuntu/Debian), pacman (Arch), dnf (Fedora)"
    log_info "Please install ghostty manually from https://ghostty.org/docs/install/binary"
    exit 1
fi
{{ else }}
log_error "Unsupported OS: {{ .chezmoi.os }}"
exit 1
{{ end }}
{{ end }}