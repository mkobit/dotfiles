{{- if .zsh.set_as_default_login_shell }}#!/bin/bash

# logging.sh hash: {{ includeTemplate "shell/logging.sh" | sha256sum }}
source "${CHEZMOI_SOURCE_DIR:?}/.chezmoitemplates/shell/logging.sh"

# Set zsh as default shell (runs after zsh installation)
zsh_path="$(which zsh)"

if [[ -z "$zsh_path" ]]; then
    log_error "zsh not found in PATH"
    exit 1
fi

if [[ "$SHELL" != "$zsh_path" ]]; then
    log_info "Changing default shell from $SHELL to $zsh_path"
    # Use sudo to avoid password prompt (works in both CI and interactive environments)
    if sudo chsh -s "$zsh_path" "$(whoami)"; then
        log_success "Default shell changed to zsh"
    else
        log_error "Failed to change shell to $zsh_path"
        exit 1
    fi
fi
{{- end }}