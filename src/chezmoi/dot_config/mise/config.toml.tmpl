{{- $hasEnabledTools := false -}}
{{- range $tool, $config := .mise.global_tools -}}
  {{- if $config.enabled -}}
    {{- $hasEnabledTools = true -}}
  {{- end -}}
{{- end -}}
{{- if $hasEnabledTools -}}
[tools]
{{- range $tool, $config := .mise.global_tools -}}
  {{- if $config.enabled }}
    {{- if hasKey $config "postinstall" }}
      {{- $postinstall := $config.postinstall -}}
      {{- if kindIs "slice" $postinstall }}
        {{- $processed := list -}}
        {{- range $item := $postinstall -}}
          {{- if hasPrefix "." $item -}}
            {{- $processed = append $processed (joinPath $.chezmoi.homeDir $item) -}}
          {{- else -}}
            {{- $processed = append $processed $item -}}
          {{- end -}}
        {{- end }}
{{ $tool | quote }} = { version = "{{ $config.version }}", postinstall = {{ $processed | toJson }} }
      {{- else }}
        {{- $path := $postinstall -}}
        {{- if hasPrefix "." $path -}}
          {{- $path = joinPath $.chezmoi.homeDir $path -}}
        {{- end }}
{{ $tool | quote }} = { version = "{{ $config.version }}", postinstall = "{{ $path }}" }
      {{- end }}
    {{- else }}
{{ $tool | quote }} = "{{ $config.version }}"
    {{- end }}
  {{- end -}}
{{- end -}}
{{- end -}}

{{- if hasKey .mise "settings" }}
[settings]
{{- range $key, $value := .mise.settings }}
{{ $key }} = {{ $value | toJson }}
{{- end }}
{{- end -}}
