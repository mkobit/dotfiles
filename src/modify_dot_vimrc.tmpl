#!/bin/sh
tempfile="$(mktemp)"
trap 'rm -rf "${tempfile}"' EXIT
cat > "${tempfile}"

# Add our managed section if not present
if ! grep -q "\" {{ .chezmoi.sourceFile }}:BEGIN:chezmoi:vim" "${tempfile}"; then
  cat >> "${tempfile}" << 'EOF'

" {{ .chezmoi.sourceFile }}:BEGIN:chezmoi:vim
" Generated by chezmoi modify script - Host: {{ .chezmoi.hostname }} User: {{ .chezmoi.username }}
" WARNING: Do not edit this section manually - managed by chezmoi
source {{ .chezmoi.homeDir }}/.dotfiles/vim/config.vim
" {{ .chezmoi.sourceFile }}:END:chezmoi:vim
EOF
fi

cat "${tempfile}"